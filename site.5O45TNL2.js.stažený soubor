import{a as Se,b as D,c as He,d as L,f as Pe}from"./lib.UAGMYVLL.js";import{a as A}from"./lib.SEA7D3S2.js";import{a as Me}from"./lib.OTNRCS6G.js";import{a as ke}from"./lib.XDYZBMZL.js";import"./lib.P2KHB2MX.js";import{g as Ee}from"./lib.AKJPVQG4.js";import{b as xe}from"./lib.2ZZTRHNQ.js";import{a as P,b as Ce,c as $e,d as B,f as Le}from"./lib.QC55EFTH.js";import{I as W,O as H,Q as F,S as me,V as ue,b as le,ca as R,e as de,ga as _,h as k,ha as be,ia as Te,m as pe}from"./lib.IUYHUHRA.js";import{c as C,e as we,g as ye,h as ve}from"./lib.MSWDVTRS.js";import"./lib.BXUODSEE.js";import"./lib.TPNYGJOG.js";import"./lib.JDGIJSRT.js";import"./lib.SM2D2BUH.js";import{a as he,c as fe,i as ge}from"./lib.BDXL3LOQ.js";import"./lib.PUZNKYJD.js";import"./lib.XN2YPPXF.js";import"./lib.K7BTCZAK.js";import{a as p}from"./lib.K5BZ6UV3.js";import"./lib.LE4HQ5U6.js";import{h as w,o as ce}from"./lib.PA5MQ22V.js";import{H as se,K as re,M as ae,a as ie,i as oe,j as ne,n as T,o as E,u as g}from"./lib.RD75MZYZ.js";import"./lib.XNXLGS2X.js";var N,I=()=>{N&&clearTimeout(N),N=void 0,$("#announce").remove()},x=e=>{if(I(),e.msg){$("body").append('<div id="announce" class="announce">'+E(e.msg)+(e.date?'<time class="timeago" datetime="'+e.date+'"></time>':"")+'<div class="actions"><a class="close">\xD7</a></div></div>').find("#announce .close").on("click",I);let t=e.date?new Date(e.date).getTime()-Date.now():5e3;t>0?N=setTimeout(I,t):I(),e.date&&p.emit("content-loaded")}},et=()=>{let e=document.body.getAttribute("data-announce");return e&&JSON.parse(e)},Ae=et();Ae&&x(Ae);var M=class{constructor(t){this.el=t;this.loaded=!1;this.receive=(t,i)=>{this.users.clear(),t.forEach((o,r)=>{let n=this.insert(o);n.patronColor=i.patronColors[r],n.playing=i.playing.includes(n.id)}),this.repaint()};this.repaint=()=>{this.loaded&&requestAnimationFrame(()=>{var i;let t=Array.from(this.users.keys()).sort();this.titleEl.innerHTML=i18n.site.nbFriendsOnline(t.length,this.loaded?`<strong>${t.length}</strong>`:"-"),(i=this.el.querySelector(".nobody"))==null||i.classList.toggle("none",!!t[0]),this.el.querySelector(".list").innerHTML=t.map(o=>this.renderFriend(this.users.get(o))).join("")})};this.renderFriend=t=>{let o=`<i class="line${t.patronColor?` patron paco${t.patronColor}`:""}"></i>`,r=t.title?`<span class="utitle"${t.title==="BOT"?" data-bot":""}>${t.title}</span>&nbsp;`:"",n="/@/"+t.name,s=t.playing?`<a data-icon="${"\uE010"}" class="tv ulpt" data-pt-pos="nw" href="${n}/tv" data-href="${n}"></a>`:"";return`<div><a class="online user-link ulpt" data-pt-pos="nw" href="${n}">${o}${r}${t.name}</a>${s}</div>`};this.enters=(t,i)=>{let o=this.insert(t);o.playing=i.playing,o.patronColor=i.patronColor,this.repaint()};this.leaves=t=>{this.users.delete(this.getId(t)),this.repaint()};this.playing=t=>{this.insert(t).playing=!0,this.repaint()};this.stopped_playing=t=>{this.insert(t).playing=!1,this.repaint()};this.insert=t=>{let i=this.getId(t),o=this.users.get(i);if(o)return o;let r=this.toFriend(t);return this.users.set(i,r),r};this.getId=t=>t.toLowerCase().replace(/^\w+\s/,"");this.toFriend=t=>{let i=t.split(" ");return{id:i[i.length-1].toLowerCase(),name:i[i.length-1],title:i.length>1?i[0]:void 0,playing:!1}};let i=A.onlineFriends;this.titleEl=this.el.querySelector(".friend_box_title"),this.titleEl.addEventListener("click",()=>{var o;(o=this.el.querySelector(".content_wrap"))==null||o.classList.toggle("none"),this.loaded||(this.loaded=!0,i.request())}),this.users=new Map,i.events.on("onlines",this.receive),i.events.on("enters",this.enters),i.events.on("leaves",this.leaves),i.events.on("playing",this.playing),i.events.on("stopped_playing",this.stopped_playing)}};var Oe=e=>{var t;return(t=document.querySelector(".crosstable"))==null?void 0:t.contains(e)},We=(e,t)=>i=>{let o=(i.dataset.href||i.href).replace(/\?.+$/,"");t&&t(o),w(o+"/mini").then(r=>{let n=document.getElementById(e);n.innerHTML=r,p.emit("content-loaded",n)})},K=(e,t)=>`<a class="btn-rack__btn" href="${e}" data-icon="${t}"></a>`,Y=(e,t)=>$(e).removeClass("ulpt").powerTip({preRender:We("powerTip",i=>{let o=i.slice(3),r=e.dataset.name||$(e).html();$("#powerTip").html('<div class="upt__info"><div class="upt__info__top"><span class="user-link offline">'+r+'</span></div></div><div class="upt__actions btn-rack">'+K("/@/"+o+"/tv","\uE010")+K("/inbox/new?user="+o,"\uE041")+K("/?user="+o+"#friend","\uE033")+'<a class="btn-rack__btn relation-button" disabled></a></div>')}),placement:t||e.getAttribute("data-pt-pos")||(Oe(e)?"n":"s")}),z=e=>$(e).removeClass("glpt").powerTip({preRender:We("miniGame",()=>H),placement:Oe(e)?"n":"w",popupId:"miniGame"});function De(e,t,i){"ontouchstart"in window&&!e.classList.contains("mobile-powertip")||(i(e),$.powerTip.show(e,t))}function Ie(e,t,i){T(()=>Array.prototype.forEach.call(e.querySelectorAll(t),o=>i(o)),800)}function y(e){return(typeof e=="string"?$(e):e)[0]}var ot={watchMouse(){document.body.addEventListener("mouseover",e=>{let t=e.target;t.classList.contains("ulpt")?De(t,e,Y):t.classList.contains("glpt")&&De(t,e,z)})},manualGameIn(e){Ie(e,".glpt",z)},manualGame:z,manualUser:Y,manualUserIn(e){Ie(e,".ulpt",Y)}},O=ot,c={scoped:{},currentX:0,currentY:0,previousX:0,previousY:0,mouseTrackingActive:!1,delayInProgress:!1,windowWidth:0,windowHeight:0,scrollTop:0,scrollLeft:0},v={none:0,top:1,bottom:2,left:4,right:8};$.fn.powerTip=function(e){if(!this.length)return this;let t=Object.assign({},nt,e),i=new U(t);return T(()=>at()),this.each((o,r)=>{let n=$(r);"displayController"in r&&$.powerTip.destroy(r),r.displayController=new j(n,t,i)}),this.on({mouseenter:function(o){$.powerTip.show(this,o)},mouseleave:function(){$.powerTip.hide(this)}}),this};var nt={popupId:"powerTip",intentSensitivity:7,intentPollInterval:150,closeDelay:150,placement:"n",smartPlacement:!0,defaultSize:[260,120],offset:10},st={n:["n","ne","nw","s","se","sw","e","w"],e:["e","ne","se","w","nw","sw","n","s"],s:["s","se","sw","n","ne","nw","e","w"],w:["w","nw","sw","e","ne","se","n","s"],nw:["nw","w","sw","n","s","se","nw","e"],ne:["ne","e","se","n","s","sw","ne","w"],sw:["sw","w","nw","s","n","ne","sw","e"],se:["se","e","ne","s","n","nw","se","w"]};$.powerTip={show(e,t){return t?(Fe(t),c.previousX=t.pageX,c.previousY=t.pageY,e.displayController.show()):e.displayController.show(!0,!0),e},reposition(e){return e.displayController.resetPosition(),e},hide(e,t){return e.displayController.hide(t),e},destroy(e){var t;(t=e.displayController)==null||t.hide(!0)}};function X(){return{left:"auto",top:"auto",right:"auto",bottom:"auto"}}var j=class{constructor(t,i,o){this.element=t;this.options=i;this.tipController=o;this.scoped={};this.el=y(t),this.scoped=c.scoped[i.popupId]}show(t,i){this.cancel(),this.el.hasActiveHover||(t?(i&&(this.el.forcedOpen=!0),this.tipController.showTip(this.element)):(this.scoped.tipOpenImminent=!0,this.hoverTimer=setTimeout(()=>{this.hoverTimer=void 0,this.checkForIntent()},this.options.intentPollInterval)))}hide(t){this.cancel(),this.scoped.tipOpenImminent=!1,this.el.hasActiveHover&&(this.el.forcedOpen=!1,t?this.tipController.hideTip(this.element):(this.scoped.delayInProgress=!0,this.hoverTimer=setTimeout(()=>{this.hoverTimer=void 0,this.tipController.hideTip(this.element),c.delayInProgress=!1},this.options.closeDelay)))}checkForIntent(){var r;let t=Math.abs(c.previousX-c.currentX),i=Math.abs(c.previousY-c.currentY);t+i<((r=this.options.intentSensitivity)!=null?r:0)?this.tipController.showTip(this.element):(c.previousX=c.currentX,c.previousY=c.currentY,this.show())}cancel(){clearTimeout(this.hoverTimer),this.scoped.delayInProgress=!1}resetPosition(){this.tipController.resetPosition(this.element)}};function rt(){return{compute(t,i,o,r,n){var d,m,h;i=(h=(m=(d=site.powertip).forcePlacementHook)==null?void 0:m.call(d,t[0]))!=null?h:i;let s=i.split("-")[0],a=X(),l=e(t,s);switch(i){case"n":a.left=l.left-o/2,a.bottom=c.windowHeight-l.top+n;break;case"e":a.left=l.left+n,a.top=l.top-r/2;break;case"s":a.left=l.left-o/2,a.top=l.top+n;break;case"w":a.top=l.top-r/2,a.right=c.windowWidth-l.left+n;break;case"nw":a.bottom=c.windowHeight-l.top+n,a.right=c.windowWidth-l.left-20;break;case"ne":a.left=l.left-20,a.bottom=c.windowHeight-l.top+n;break;case"sw":a.top=l.top+n,a.right=c.windowWidth-l.left-20;break;case"se":a.left=l.left-20,a.top=l.top+n;break}return a}};function e(t,i){let o=t.offset(),r=t.outerWidth(),n=t.outerHeight(),s=0,a=0;switch(i){case"n":s=o.left+r/2,a=o.top;break;case"e":s=o.left+r,a=o.top+n/2;break;case"s":s=o.left+r/2,a=o.top+n;break;case"w":s=o.left,a=o.top+n/2;break;case"nw":s=o.left,a=o.top;break;case"ne":s=o.left+r,a=o.top;break;case"sw":s=o.left,a=o.top+n;break;case"se":s=o.left+r,a=o.top+n;break}return{left:s,top:a}}}var U=class{constructor(t){this.options=t;this.placementCalculator=rt();if(this.tipElement=$("#"+t.popupId),c.scoped[t.popupId]||(c.scoped[t.popupId]={}),this.scoped=c.scoped[t.popupId],this.tipElement.length===0){let i=document.createElement("div");i.id=t.popupId,this.tipElement=$(i),$("body").append(this.tipElement)}this.tipElement.on({mouseenter:()=>{this.scoped.activeHover&&this.scoped.activeHover[0].displayController.cancel()},mouseleave:()=>{this.scoped.activeHover&&this.scoped.activeHover[0].displayController.hide()}})}showTip(t){y(t).hasActiveHover=!0,this.doShowTip(t)}doShowTip(t){if(y(t).hasActiveHover){if(this.scoped.isTipOpen){this.scoped.isClosing||this.hideTip(this.scoped.activeHover),setTimeout(()=>{this.doShowTip(t)},100);return}this.tipElement.empty(),this.options.preRender&&this.options.preRender(y(t)),this.scoped.activeHover=t,this.scoped.isTipOpen=!0,this.resetPosition(t),this.tipElement.show(),this.scoped.desyncTimeout||(this.scoped.desyncTimeout=setInterval(()=>this.closeDesyncedTip(),500))}}hideTip(t){this.scoped.isClosing=!0,this.scoped.activeHover=null,this.scoped.isTipOpen=!1,this.scoped.desyncTimeout=clearInterval(this.scoped.desyncTimeout),y(t).hasActiveHover=!1,y(t).forcedOpen=!1,this.tipElement.hide();let i=X();this.scoped.isClosing=!1,this.tipElement.removeClass(),i.top=c.currentY+this.options.offset,i.left=c.currentX+this.options.offset,this.tipElement.css(i)}resetPosition(t){if(this.options.smartPlacement){let i=st[this.options.placement];y(t).classList.contains("mobile-powertip")&&(i=[...i,"s"]),$.each(i,(o,r)=>ct(this.placeTooltip(t,r),this.tipElement.outerWidth()||this.options.defaultSize[0],this.tipElement.outerHeight()||this.options.defaultSize[1])!==v.none)}else this.placeTooltip(t,this.options.placement)}placeTooltip(t,i){let o=0,r,n,s=X();s.top=0,s.left=0,this.tipElement.css(s);do r=this.tipElement.outerWidth()||this.options.defaultSize[0],n=this.tipElement.outerHeight()||this.options.defaultSize[1],s=this.placementCalculator.compute(t,i,r,n,this.options.offset),this.tipElement.css(s);while(++o<=5&&(r!==this.tipElement.outerWidth()||n!==this.tipElement.outerHeight()));return s}closeDesyncedTip(){let t=!1;this.scoped.isTipOpen&&!this.scoped.isClosing&&!this.scoped.delayInProgress&&(this.scoped.activeHover[0].hasActiveHover===!1||this.scoped.activeHover.is(":disabled")?t=!0:!Ne(this.scoped.activeHover)&&!this.scoped.activeHover.is(":focus")&&!this.scoped.activeHover[0].forcedOpen&&(Ne(this.tipElement)||(t=!0)),t&&this.hideTip(this.scoped.activeHover))}};function at(){if(!c.mouseTrackingActive){c.mouseTrackingActive=!0;let e=$(window);c.scrollLeft=window.scrollX,c.scrollTop=window.scrollY,c.windowWidth=e.width(),c.windowHeight=e.height(),document.addEventListener("mousemove",Fe),window.addEventListener("resize",function(){c.windowWidth=e.width(),c.windowHeight=e.height()},{passive:!0}),window.addEventListener("scroll",function(){let t=window.scrollX,i=window.scrollY;t!==c.scrollLeft&&(c.currentX+=t-c.scrollLeft,c.scrollLeft=t),i!==c.scrollTop&&(c.currentY+=i-c.scrollTop,c.scrollTop=i)},{passive:!0})}}function Fe(e){c.currentX=e.pageX,c.currentY=e.pageY}function Ne(e){let t=e.offset();return c.currentX>=t.left&&c.currentX<=t.left+e.outerWidth()&&c.currentY>=t.top&&c.currentY<=t.top+e.outerHeight()}function ct(e,t,i){let o=c.scrollTop,r=c.scrollLeft,n=o+c.windowHeight,s=r+c.windowWidth,a=v.none;return(e.top<o||Math.abs(Number(e.bottom)-c.windowHeight)-i<o)&&(a|=v.top),(Number(e.top)+i>n||Math.abs(Number(e.bottom)-c.windowHeight)>n)&&(a|=v.bottom),(e.left<r||Number(e.right)+t>s)&&(a|=v.left),(Number(e.left)+t>s||e.right<r)&&(a|=v.right),a}async function Re(){if(!("serviceWorker"in navigator&&"Notification"in window&&"PushManager"in window))return;let e=new URL(Se(He("serviceWorker"),{pathOnly:!0}),self.location.href);e.searchParams.set("asset-url",document.body.getAttribute("data-asset-url"));let t;try{let i=await navigator.serviceWorker.register(e.href,{scope:"/",updateViaCache:"all"}),o=g.make("push-subscribed"),r=parseInt(o.get()||"0",10)+432e5<Date.now(),n=document.body.getAttribute("data-vapid"),s=await i.pushManager.getSubscription();if(!n||Notification.permission!=="granted")return o.remove();if(s&&!r)return;if(t=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}),!t)throw new Error(JSON.stringify(await i.pushManager.permissionState()));let a=await fetch("/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(a.ok&&!a.redirected)o.set(""+Date.now());else throw new Error(a.statusText)}catch(i){C("serviceWorker.ts:",i.message,t),t!=null&&t.endpoint&&t.unsubscribe()}}function _e(){var r;let e=document.getElementById("top"),t=`<div class="initiating">${H}</div>`,i=n=>{let s=document.querySelector(n),a=s&&window.getComputedStyle(s).display;return a&&a!=="none"};"ontouchstart"in window&&window.matchMedia("(min-width: 1020px)").matches&&$("#topnav section > a").removeAttr("href");let o=n=>{document.getElementById("topnav").contains(n.target)||n.preventDefault()};$("#tn-tg").on("change",n=>{let s=n.target.checked;s?(document.body.addEventListener("touchmove",o,{passive:!1}),$(n.target).addClass("opened")):(document.body.removeEventListener("touchmove",o),setTimeout(()=>$(n.target).removeClass("opened"),200)),document.body.classList.toggle("masked",s)}),$(e).on("click",".toggle",function(){let n=$(this).parent().toggleClass("shown");return n.siblings(".shown").removeClass("shown"),setTimeout(()=>{let s=a=>{var d;let l=a.target;!l.isConnected||(d=n[0])!=null&&d.contains(l)||(n.removeClass("shown"),$("html").off("click",s))};$("html").on("click",s)},10),!1});{let n,s=$("#challenge-toggle"),a=s.find("span");s.one("mouseover click",()=>l());let l=function(d){if(n)return;let m=$("#challenge-app").html(t);D("challenge"),n=L("challenge",{init:{el:m[0],data:d,show(){i("#challenge-app")||s.trigger("click")},setCount(h){let f=a.attr("title").replace(/\d+/,h.toString());a.data("count",h).attr("title",f).attr("aria-label",f)},pulse(){s.addClass("pulse")}}})};p.on("socket.in.challenges",async d=>{n?(await n).update(d):l(d)}),p.on("challenge-app.open",()=>s.trigger("click"))}{let n,s=$("#notify-toggle"),a=s.find("span"),l="#notify-app",d=m=>{if(n)return;let h=$("#notify-app").html(t);D("notify"),n=L("notify",{init:{el:h.empty()[0],data:m,isVisible:()=>i(l),updateUnread(f){let ee=a.data("count")||0;f==="increment"&&(f=ee+1),this.isVisible()&&(f=0);let te=a.attr("title").replace(/\d+/,f.toString());return a.data("count",f).attr("title",te).attr("aria-label",te),f&&f!==ee},show(){i(l)||s.trigger("click")},setNotified(){ve("notified")},pulse(){s.addClass("pulse")}}})};s.one("mouseover click",()=>d()).on("click",()=>{"Notification"in window&&Notification.requestPermission(),setTimeout(async()=>{n&&i(l)&&(await n).onShow()},200)}),p.on("socket.in.notifications",async m=>{n?(await n).update(m):d(m)}),p.on("notify-app.set-read",async m=>{n?(await n).setMsgRead(m):d()})}{let n=oe(()=>L("dasher"));$("#top .dasher .toggle").one("mouseover click",function(){$(this).removeAttr("href"),D("dasher"),n()})}{let n=$("#clinput");if(!n.length)return;let s=n.find("input"),a=!1,l=()=>{a||(a=!0,L("cli",{init:{input:s[0]}}).catch(()=>a=!1))};s.on({blur(){s.val(""),$("body").removeClass("clinput")},focus(){l(),$("body").addClass("clinput")}}),n.find("a").on({mouseover:l,click(){$("body").hasClass("clinput")?s[0].blur():s[0].focus()}}),n.on("mouseenter",()=>{s[0]!==document.activeElement&&s[0].focus()}),n.on("mouseleave",()=>{s.val()||s[0].blur()}),site.mousetrap.bind("/",()=>{s.val("/"),s[0].focus(),e.classList.remove("hide")}).bind("s",()=>{s[0].focus(),e.classList.remove("hide")})}{let n=window.scrollY;if(n>0&&e.classList.add("scrolled"),window.addEventListener("scroll",()=>{let s=window.scrollY;if(e.classList.toggle("scrolled",s>0),s>n+10)e.classList.add("hide");else if(s<=fe(n-20,{min:0,max:document.body.scrollHeight-window.innerHeight}))e.classList.remove("hide");else return;n=Math.max(0,s)},{passive:!0}),!de()||site.blindMode||!document.querySelector("main.analyse"))return;(r=document.querySelector(".main-board"))==null||r.addEventListener("dblclick",s=>{n=-9999,window.scrollTo({top:parseInt(window.getComputedStyle(document.body).getPropertyValue("---site-header-height")),behavior:"instant"}),s.preventDefault()},{passive:!0})}}function Be(){let e;window.addEventListener("resize",()=>{cancelAnimationFrame(e),e=requestAnimationFrame(t)});function t(){document.body.style.setProperty("---viewport-height",`${window.innerHeight}px`)}}function Ve(){_e(),$("#main-wrap").on("click",".copy-me__button",function(){let e=()=>{$(this).attr("data-icon","\uE023").removeClass("button-metal"),setTimeout(()=>$(this).attr("data-icon","\uE070").addClass("button-metal"),1e3)},t=$(this).parent().hasClass("fetch-content");return $(this.parentElement.firstElementChild).each(function(){try{t?ce(this.href,e):navigator.clipboard.writeText(this.value||this.href).then(e)}catch(i){console.error(i)}}),!1}),$("body").on("click",".relation-button",function(){let e=$(this).addClass("processing").css("opacity",.3),t=this.closest(".dropdown-overflow");return t?t.dispatchEvent(new CustomEvent("reload",{detail:this.href})):w(this.href,{method:"post"}).then(i=>{e.hasClass("aclose")?e.hide():i.includes("relation-actions")?e.parent().replaceWith(i):e.replaceWith(i)}),!1}),$(".user-autocomplete").each(function(){let e=!!this.autofocus,t=()=>xe({input:this,friend:!!this.dataset.friend,tag:this.dataset.tag,focus:e});e?t():$(this).one("focus",t)}),$("#main-wrap").on("click",".yes-no-confirm, .ok-cancel-confirm",async function(e){var o;if(!e.isTrusted)return;e.preventDefault();let[t,i]=this.classList.contains("yes-no-confirm")?[i18n.site.yes,i18n.site.no]:[i18n.site.ok,i18n.site.cancel];await ue(this.title||"Confirm this action?",t,i)&&((o=e.target)==null||o.click())}),$("#main-wrap").on("click","a.bookmark",function(){let e=$(this).toggleClass("bookmarked");w(this.href,{method:"post"});let t=(parseInt(e.text(),10)||0)+(e.hasClass("bookmarked")?1:-1);return e.find("span").html(""+(t>0?t:"")),!1})}var G=e=>requestAnimationFrame(()=>{let t=Date.now();[].slice.call((e||document).getElementsByClassName("timeago"),0,99).forEach(i=>{let o=i.classList,r=o.contains("abs"),n=o.contains("set");if(i.lichessDate=i.lichessDate||B(i.getAttribute("datetime")),!n){let s=Ce(i.lichessDate);r?i.textContent=s:i.setAttribute("title",s),o.add("set"),(r||o.contains("once"))&&o.remove("timeago")}if(o.contains("remaining")){let s=(i.lichessDate.getTime()-t)/1e3;i.textContent=ut(s)}else if(!r){let s=(t-i.lichessDate.getTime())/1e3;i.textContent=Le(s),Math.abs(s)>9999&&o.remove("timeago")}site.blindMode&&(i.removeAttribute("title"),i.removeAttribute("datetime"))})}),J=e=>{G(),setTimeout(()=>J(e*1.1),e)},qe=()=>{requestAnimationFrame(()=>{[].slice.call(document.querySelectorAll("time[format]"),0,99).forEach(e=>{let t=e.getAttribute("format");if(t){let i=B(e.getAttribute("datetime"));e.textContent=mt(i,t)}})})},pt={d:{year:"numeric",month:"2-digit",day:"2-digit"},D:{year:"numeric",month:"long",day:"numeric"},t:{hour:"numeric",minute:"numeric"},T:{hour:"numeric",minute:"numeric",second:"numeric"},f:{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},F:{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},s:{year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric"},S:{year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric"}},mt=(e,t)=>{if(t==="R")return $e(e);let i=pt[t];return i?new Intl.DateTimeFormat(P,i).format(e):e.toString()},ut=e=>e<1?i18n.timeago.completed:e<3600?i18n.timeago.nbMinutesRemaining(Math.floor(e/60)):i18n.timeago.nbHoursRemaining(Math.floor(e/3600));function Ke(){return window.location.href.replace(/^(https:\/\/)?(?:lichess|lichess1)\.org\//,"/")}function Ye(){window.addEventListener("error",async e=>{var i,o,r,n;let t=e.filename?` - (${e.filename}:${e.lineno}:${e.colno})`:"";C(`${Ke()} - ${e.message}${t}
${(o=(i=e.error)==null?void 0:i.stack)!=null?o:""}`.trim()),site.debug&&F({htmlText:E(`${e.message}${t}
${(n=(r=e.error)==null?void 0:r.stack)!=null?n:""}`),class:"debug",show:!0})}),window.addEventListener("unhandledrejection",async e=>{let t=e.reason;if(typeof t!="string")try{t=JSON.stringify(e.reason)}catch(i){t="unhandled rejection, reason not a string"}C(`${Ke()} - ${t}`),site.debug&&F({htmlText:E(t),class:"debug",show:!0})})}function ze(){Ye();let e=location.hash==="#blind",t=location.hash.startsWith("#debug");requestAnimationFrame(()=>{R(),_(),p.on("content-loaded",R),p.on("content-loaded",_),J(1e3),p.on("content-loaded",G),qe(),p.on("content-loaded",W)}),T(()=>{let i=document.getElementById("friend_box");i&&new M(i);let o=document.querySelector(".chat__members");if(o&&Me(o),$(".subnav__inner").each(function(){ne(this,".active",!0)}),O.watchMouse(),Ve(),k()&&!("MSStream"in window)){let n=document.querySelector("meta[name=viewport]");n.setAttribute("content",n.getAttribute("content")+",maximum-scale=1.0")}W(),window.addEventListener("resize",ke),e&&!site.blindMode&&setTimeout(()=>$("#blind-mode button").trigger("click"),1500),site.debug&&site.asset.loadEsm("bits.devMode"),t&&site.asset.loadEsm("bits.diagnosticDialog"),Re(),console.info("Lichess is open source! See https://lichess.org/source"),we(),wt()&&se("upgrade.nag",{days:14})&&p.after("polyfill.dialog").then(()=>me(`Your browser is out of date.
Lichess may not work properly.`)),p.on("socket.in.redirect",n=>{site.unload.expected=!0,site.redirect(n)}),p.on("socket.in.fen",n=>document.querySelectorAll(".mini-game-"+n.id).forEach(s=>be(s,n))),p.on("socket.in.finish",n=>document.querySelectorAll(".mini-game-"+n.id).forEach(s=>Te(s,n.win))),p.on("socket.in.announce",x),p.on("socket.in.tournamentReminder",n=>{if($("#announce").length||document.body.dataset.tournamentId===n.id)return;let s="/tournament/"+n.id;$("body").append($('<div id="announce">').append($(`<a data-icon="${"\uE045"}" class="text">`).attr("href",s).text(n.name)).append($('<div class="actions">').append($(`<a class="withdraw text" data-icon="${"\uE038"}">`).attr("href",s+"/withdraw").text(i18n.site.pause).on("click",function(){return w(this.href,{method:"post"}),$("#announce").remove(),!1})).append($(`<a class="text" data-icon="${"\uE025"}">`).attr("href",s).text(i18n.site.resume))))});let r=le();typeof r.addEventListener=="function"&&r.addEventListener("change",n=>{document.body.dataset.theme==="system"&&(document.documentElement.className=n.matches?"light":"dark")}),yt()},800)}var wt=()=>pe({below:"15.4"});function yt(){["orbitofavatars.com","bealive.fit"].includes(location.host)&&(location.href="https://lichess.org"+location.pathname)}var b={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"};for(let e=1;e<20;++e)b[111+e]="f"+e;for(let e=0;e<=9;++e)b[e+96]=e.toString();var vt={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},bt={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},Tt=e=>{if(e.type==="keypress"){let t=String.fromCharCode(e.which);return e.shiftKey?t:t.toLowerCase()}return b[e.which]||vt[e.which]||String.fromCharCode(e.which).toLowerCase()},Et=(e,t)=>e.sort().join(",")===t.sort().join(","),kt=e=>{let t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t},Xe=e=>e==="shift"||e==="ctrl"||e==="alt"||e==="meta",Ct=(()=>{let e;return()=>{if(!e){e={};for(let t in b)parseInt(t,10)>95&&parseInt(t,10)<112||Object.prototype.hasOwnProperty.call(b,t)&&(e[b[t]]=t)}return e}})(),$t=(e,t,i)=>(i=i||(Ct()[e]?"keydown":"keypress"),i==="keypress"&&t.length?"keydown":i),Lt=e=>e==="+"?["+"]:e.replace(/\+{2}/g,"+plus").split("+"),xt=(e,t)=>{let i,o=[];for(i of Lt(e))i=bt[i]||i,Xe(i)&&o.push(i);return{key:i,modifiers:o,action:$t(i,o,t)}},S=class{constructor(t){this.bindings={};this.bind=(t,i,o,r=!0)=>{var n,s,a;for(let l of Array.isArray(t)?t:[t]){let d=xt(l,o);(a=(n=this.bindings)[s=d.key])!=null||(n[s]=[]),(r||!this.bindings[d.key].some(m=>ge(m.modifiers,d.modifiers)))&&this.bindings[d.key].push({combination:l,callback:i,modifiers:d.modifiers,action:d.action})}return this};this.unbind=t=>{var i;(i=this.bindings[t])==null||i.forEach((o,r)=>{o.modifiers.length===0&&this.bindings[t].splice(r,1)})};this.handleKeyEvent=t=>{typeof t.which!="number"&&(t.which=t.keyCode);let i=t.target;for(let o of this.getMatches(t))(o.combination==="esc"||i.tagName!=="INPUT"&&i.tagName!=="SELECT"&&i.tagName!=="TEXTAREA"&&!i.isContentEditable&&!i.hasAttribute("trap-bypass"))&&(o.callback(t),t.preventDefault(),t.stopPropagation())};this.getMatches=t=>{let i=Tt(t),o=t.type,r=o==="keyup"&&Xe(i)?[i]:kt(t);return(this.bindings[i]||[]).filter(n=>o===n.action&&(o==="keypress"&&!t.metaKey&&!t.ctrlKey||Et(r,n.modifiers)))};t=t||document,t.addEventListener("keypress",i=>this.handleKeyEvent(i)),t.addEventListener("keydown",i=>this.handleKeyEvent(i)),t.addEventListener("keyup",i=>this.handleKeyEvent(i))}};var je=!1,Ue=async(e,t)=>{try{t&&await ae(site.sound.play("genericNotify"),1e3)}catch(r){console.warn(r)}let i;if(typeof e=="string")i=e;else if(i=e.url,e.cookie){let r=[encodeURIComponent(e.cookie.name)+"="+e.cookie.value,"; max-age="+e.cookie.maxAge,"; path=/","; domain="+location.hostname].join("");document.cookie=r}let o="//"+location.host+"/"+i.replace(/^\//,"");je=o,location.href=o},Q={expected:!1},Ge=e=>{e&&console.warn(e),!je&&(Q.expected=!0,ye(),location.hash?location.reload():location.assign(location.href))};var Qe=new class{constructor(){this.ctx=Je();this.listeners=new Set;this.sounds=new Map;this.paths=new Map;this.theme=document.body.dataset.soundSet;this.speechStorage=g.boolean("speech.enabled");this.voiceStorage=g.make("speech.voice");this.volumeStorage=g.make("sound-volume");this.primerEvents=["touchend","pointerup","pointerdown","mousedown","keydown"];this.primer=()=>{var e;(e=this.ctx)==null||e.resume().then(()=>{setTimeout(()=>$("#warn-no-autoplay").removeClass("shown"),500)});for(let t of this.primerEvents)window.removeEventListener(t,this.primer,{capture:!0})};this.throttled=re(100,(e,t)=>this.play(e,t));this.setVolume=this.volumeStorage.set;this.getVolume=()=>{let e=parseFloat(this.volumeStorage.get()||"");return e>=0?e:.7};this.getVoice=()=>{var o,r;let e={name:"",lang:document.documentElement.lang.split("-")[0]};try{e=JSON.parse((o=this.voiceStorage.get())!=null?o:JSON.stringify(e))}catch(n){}let t=this.getVoiceMap();return(r=t.get(e.name))!=null?r:[...t.values()].find(n=>n.lang.startsWith(e.lang))};this.getVoiceMap=()=>{let e=speechSynthesis.getVoices(),t=new Map;for(let i of["en",document.documentElement.lang.split("-")[0],document.documentElement.lang])e.filter(o=>o.lang.startsWith(i)).sort((o,r)=>o.lang.localeCompare(r.lang)).forEach(o=>t.set(o.name,o));return t};this.setVoice=e=>{e?this.voiceStorage.set(JSON.stringify({name:e.name,lang:e.lang})):this.voiceStorage.remove()};this.enabled=()=>this.theme!=="silent"&&this.getVolume()!==0;this.speech=e=>(ie(e)&&this.speechStorage.set(e),this.speechStorage.get());this.say=(e,t=!1,i=!1,o=!1)=>this.sayLazy(()=>e,t,i,o);this.sayLazy=(e,t=!1,i=!1,o=!1)=>{if(typeof window.speechSynthesis=="undefined")return!1;try{if(t&&speechSynthesis.cancel(),!this.speech()&&!i)return!1;let r=new SpeechSynthesisUtterance(e()),n=this.getVoice();return n?r.voice=n:r.lang=o?document.documentElement.lang:"en-GB",r.volume=this.getVolume(),k()||(r.onstart=()=>this.listeners.forEach(s=>s("start",e())),r.onend=r.onerror=()=>this.listeners.forEach(s=>s("stop"))),window.speechSynthesis.speak(r),!0}catch(r){return console.error(r),!1}};this.saySan=(e,t,i)=>this.sayLazy(()=>Ee(e),t,i);this.sayOrPlay=(e,t)=>this.say(t)||this.play(e);this.changeSet=e=>{var t;k()&&((t=this.ctx)==null||t.resume()),this.theme=e};var e;this.primerEvents.forEach(t=>window.addEventListener(t,this.primer,{capture:!0})),(e=window.speechSynthesis)==null||e.getVoices()}async load(e,t){var s;if(!this.ctx||(t?this.paths.set(e,t):t=(s=this.paths.get(e))!=null?s:this.resolvePath(e),!t))return;if(this.sounds.has(t))return this.sounds.get(t);let i=await fetch(t);if(!i.ok)throw new Error(`${t} failed ${i.status}`);let o=await i.arrayBuffer(),r=await new Promise((a,l)=>{var d,m,h;((d=this.ctx)==null?void 0:d.decodeAudioData.length)===1?(m=this.ctx)==null||m.decodeAudioData(o).then(a).catch(l):(h=this.ctx)==null||h.decodeAudioData(o,a,l)}),n=new Z(this.ctx,r);return this.sounds.set(t,n),n}resolvePath(e){if(!this.enabled())return;let t=this.theme;if(this.theme==="music"||this.speech()){if(["move","capture","check","checkmate"].includes(e))return;t="standard"}return this.url(`${t}/${e[0].toUpperCase()+e.slice(1)}.mp3`)}url(e){return site.asset.url(`sound/${e}`)}async play(e,t=1){if(!this.enabled())return;let i=await this.load(e);i&&await this.resumeWithTest()&&await i.play(this.getVolume()*t)}async move(e){var i,o,r,n,s;let t=(i=e==null?void 0:e.volume)!=null?i:1;(e==null?void 0:e.filter)!=="music"&&this.theme!=="music"&&(e!=null&&e.name?this.throttled(e.name,t):((o=e==null?void 0:e.san)!=null&&o.includes("x")?this.throttled("capture",t):this.throttled("move",t),(r=e==null?void 0:e.san)!=null&&r.includes("#")?this.throttled("checkmate",t):(n=e==null?void 0:e.san)!=null&&n.includes("+")&&this.throttled("check",t))),!((e==null?void 0:e.filter)==="game"||this.theme!=="music")&&((s=this.music)!=null||(this.music=await site.asset.loadEsm("bits.soundMove")),this.music(e))}async playAndDelayMateResultIfNecessary(e){this.theme==="standard"?this.play(e):setTimeout(()=>this.play(e),600)}async countdown(e,t=500){if(this.enabled())try{for(;e>0;){let i=[new Promise(o=>setTimeout(o,t)),this.play(`countDown${e}`)];--e>0&&i.push(this.load(`countDown${e}`)),await Promise.all(i)}await this.play("genericNotify")}catch(i){console.error(i)}}playOnce(e){let t=()=>{let i=g.make("just-played");Date.now()-parseInt(i.get(),10)<2e3||(i.set(""+Date.now()),this.play(e))};document.hasFocus()?t():setTimeout(t,10+Math.random()*500)}preloadBoardSounds(){for(let e of["move","capture","check","checkmate","genericNotify"])this.load(e)}async resumeWithTest(){var e,t;if(!this.ctx)return!1;if(this.ctx.state!=="running"&&this.ctx.state!=="suspended"&&(this.ctx.state!=="closed"&&this.ctx.close(),this.ctx=Je(),this.ctx))for(let i of this.sounds.values())i.rewire(this.ctx);return((e=this.ctx)==null?void 0:e.state)==="suspended"&&await new Promise(i=>{var r;let o=setTimeout(()=>{$("#warn-no-autoplay").addClass("shown"),i()},400);(r=this.ctx)==null||r.resume().then(()=>{clearTimeout(o),i()})}),((t=this.ctx)==null?void 0:t.state)!=="running"?!1:($("#warn-no-autoplay").removeClass("shown"),!0)}},Z=class{constructor(t,i){this.buffer=i;this.rewire(t)}play(t=1){this.node.gain.setValueAtTime(t,this.ctx.currentTime);let i=this.ctx.createBufferSource();return i.buffer=this.buffer,i.connect(this.node),new Promise(o=>{i.onended=()=>{i.disconnect(),o()},i.start(0)})}rewire(t){var i;(i=this.node)==null||i.disconnect(),this.ctx=t,this.node=this.ctx.createGain(),this.node.connect(this.ctx.destination)}};function Je(){return window.webkitAudioContext?new window.webkitAudioContext({latencyHint:"interactive"}):typeof AudioContext!="undefined"?new AudioContext({latencyHint:"interactive"}):void 0}async function Ze(){await Promise.all([Mt(),St()])}async function Mt(){let e;try{typeof window.HTMLDialogElement=="undefined"&&(e=(await import(site.asset.url("npm/dialog-polyfill.esm.js"))).default.registerDialog)}finally{p.complete("polyfill.dialog",e)}}async function St(){typeof window.ResizeObserver=="undefined"&&(window.ResizeObserver=(await import("./lib.3OD43LVY.js")).ResizeObserver)}var u=window.site;u.sri=he();u.displayLocale=P;u.blindMode=document.body.classList.contains("blind-mode");u.mousetrap=new S(document);u.powertip=O;u.asset=Pe;u.unload=Q;u.redirect=Ue;u.reload=Ge;u.announce=x;u.sound=Qe;window.lichess=A;Ze();Be();u.load.then(ze);
