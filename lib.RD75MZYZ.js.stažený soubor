var d=e=>e!==void 0,D=e=>e!=null,K=e=>!e||e.length===0,oe=e=>!K(e),se=e=>{let t=e;return r=>(d(r)&&(t=r),t)},R=(e,t)=>{let r=e;return n=>(d(n)&&(r=n,t(n)),r)},m=(e,t)=>r=>{let n;return d(r)?(n=e(r),t(r)):n=e(),n},ie=(e,t=()=>{})=>{let r=R(e,t);return r.toggle=()=>r(!r()),r};var ae=e=>{let t;return()=>(t===void 0&&(t=e()),t)},ue=(e,t,r=!1,n="instant")=>C(e,e.querySelector(t),r,n),C=(e,t,r=!1,n="instant")=>{t&&e.scrollTo(r?{behavior:n,left:t.offsetLeft-e.offsetWidth/2+t.offsetWidth/2}:{behavior:n,top:t.offsetTop-e.offsetHeight/2+t.offsetHeight/2})},ce=e=>t=>{let r=()=>$(document).one("click",n=>{document.contains(t)&&(t.contains(n.target)?r():e())});setTimeout(r,300)};function de(e){return e.replace(/-([a-z])/g,t=>t[1].toUpperCase())}var le=(e,t)=>{window.requestIdleCallback?window.requestIdleCallback(e,t?{timeout:t}:void 0):requestAnimationFrame(e)};function P(e){return typeof e!="string"&&(e=JSON.stringify(e)),/[&<>"']/.test(e)?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"):e}function ge(e){let t=document.createRange().createContextualFragment(e);return t.childElementCount===1?t.firstElementChild:t}function pe(e){return t=>e.querySelector(t)}function fe(){return document.body.dataset.user}function me(){return document.body.dataset.username}function xe(e,t){let r,n=(function*(){yield 500;for(let o=350;;)yield Math.max(100,o*=.9333333333333333)})(),s=()=>{e(),r=setTimeout(s,n.next().value),t!=null&&t()&&clearTimeout(r)};s(),document.addEventListener("pointerup",()=>clearTimeout(r),{once:!0})}var l=V(window.localStorage),Pe=V(window.sessionStorage);function y(e,t,r,n){let s="analyse."+e,o;return function(i){if(d(i)&&i!=o)o=i,l.set(e,n(i));else if(!d(o)){let a=l.get(s);D(a)&&(l.set(e,a),l.remove(s));let u=l.get(e);o=u===null?t:r(u)}return o}}var L=(e,t)=>y(e,t,r=>r,r=>r),O=(e,t)=>y(e,t,r=>r==="true",r=>r.toString()),ye=(e,t,r)=>m(L(e,t),r),he=(e,t,r)=>m(O(e,t),r),M=(e,t)=>y(e,t,r=>Number(r),r=>r+""),we=(e,t,r)=>m(M(e,t),r),v=(e,t)=>r=>{if(d(r))return l.set(e,JSON.stringify(r)),r;let n=JSON.parse(l.get(e));return n!==null?n:t()},k=(e,t,r)=>{let n=v(e,()=>[]),s=new Map(n());return(o,i)=>{d(i)&&(s.delete(o),s.set(o,i),n(Array.from(s.entries()).slice(-t)));let a=s.get(o);return d(a)?a:r()}},q=(e,t)=>r=>d(r)?(e(t,r),r):e(t),De=(e,t,r,n)=>q(k(e,r,n),t),ve=(e,t)=>{let r=v(e,()=>[]),n=new Set(r());return s=>(d(s)&&(n.add(s),n=new Set([...n].slice(-t)),r([...n])),n)};function Ve(e,t){var o,i,a;let r=Date.now(),n=Number(l.get(e))||0,s=((o=t==null?void 0:t.seconds)!=null?o:0)+((i=t==null?void 0:t.hours)!=null?i:0)*3600+((a=t==null?void 0:t.days)!=null?a:0)*24*3600;return n&&(!t||r-n<s*1e3)?!1:(l.set(e,r.toString()),!0)}function V(e){let t={get:r=>e.getItem(r),set:(r,n)=>e.setItem(r,n),fire:(r,n)=>e.setItem(r,JSON.stringify({sri:site.sri,nonce:Math.random(),value:n})),remove:r=>e.removeItem(r),make:(r,n)=>{let s=n&&`${r}--bd`,o=()=>{t.remove(r),s&&t.remove(s)};return{get:()=>{if(!s)return t.get(r);let i=Number(t.get(s));return i?Date.now()-i>n&&o():t.set(s,String(Date.now())),t.get(r)},set:i=>{t.set(r,i),s&&t.set(s,String(Date.now()))},fire:i=>t.fire(r,i),remove:o,listen:i=>window.addEventListener("storage",a=>{if(a.key!==r||a.storageArea!==e||a.newValue===null)return;let u;try{u=JSON.parse(a.newValue)}catch(c){return}u!=null&&u.sri&&u.sri!==site.sri&&i(u)})}},boolean:r=>({get:()=>t.get(r)==="1",getOrDefault:n=>{let s=t.get(r);return s===null?n:s==="1"},set:n=>t.set(r,n?"1":"0"),toggle:()=>t.set(r,t.get(r)==="1"?"0":"1")})};return t}function H(e){let t,r;return function(...n){let s=this,o=()=>(t=e.apply(s,n).finally(()=>{t=void 0,r&&(r.run(),r=void 0)}),t);return t?(r==null||r.reject(),new Promise((a,u)=>{r={run:()=>o().then(c=>(a(c),c),c=>{throw u(c),c}),reject:()=>u(new Error("Throttled"))}})):o()}}function B(e){let t=H(e);return function(...r){return t.apply(this,r).catch(()=>{})}}function N(e,t){return function(...r){let n=this;return new Promise(s=>{t.apply(n,r).finally(()=>setTimeout(s,e.apply(n,r)))})}}function Se(e,t){return B(N(e,t))}function Ie(e,t){return B(function(...r){return t.apply(this,r),new Promise(n=>setTimeout(n,e))})}function Ee(e){let t={sync:void 0,promise:e.then(r=>(t.sync=r,r))};return t}async function Ae(e,t){let r,n=new Promise((o,i)=>{r=setTimeout(()=>i(new Error("Async call timeout limit reached")),t)}),s=await Promise.race([e,n]);return r&&clearTimeout(r),s}function Ke(e,t,r=!1){let n,s=0;return function(...o){let i=this;n&&clearTimeout(n),n=void 0;let a=performance.now()-s;s=performance.now(),r&&a>t?e.apply(i,o):n=setTimeout(()=>{n=void 0,e.apply(i,o)},t)}}function Re(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}async function Le(e){let t=await W(e);return{list:()=>n(()=>r("readonly").getAllKeys()),has:o=>n(()=>r("readonly").getKey(o)).then(Boolean).catch(()=>!1),get:o=>n(()=>r("readonly").get(o)),getOpt:o=>n(()=>r("readonly").get(o)).catch(()=>{}),getMany:o=>n(()=>r("readonly").getAll(o)),put:(o,i)=>n(()=>r("readwrite").put(i,o)),count:o=>n(()=>r("readonly").count(o)),remove:o=>n(()=>r("readwrite").delete(o)),clear:()=>n(()=>r("readwrite").clear()),txn:o=>t.transaction(e.store,o),cursor:s,readCursor:async(o,i)=>{for await(let a of s(o,"readonly"))await i(a.value)},writeCursor:async(o,i)=>{for await(let a of s(o,"readwrite"))await i({value:a.value,update:u=>n(()=>a.update(u)),delete:()=>n(()=>a.delete())})},deleteDb:()=>{var o;return"deleteDatabase"in window.indexedDB&&window.indexedDB.deleteDatabase((o=e.db)!=null?o:e.store)}};function r(o){return t.transaction(e.store,o).objectStore(e.store)}function n(o){return new Promise((i,a)=>{let u=o();u.onsuccess=c=>i(c.target.result),u.onerror=c=>a(c.target.result)})}function s(o={},i){let a=r(i),u=o.index?a.index(o.index).openCursor(o.query,o.dir):a.openCursor(o.query,o.dir);return(async function*(){for(;;){let c=await n(()=>u);if(!c)break;yield c,c.continue()}})()}}function Oe(e){var o,i;let t="above"in e,r="below"in e,n=(o=e.above)!=null?o:e.min,s=(i=e.below)!=null?i:e.max;if(n!==void 0&&s!==void 0)return IDBKeyRange.bound(n,s,t,r);if(n!==void 0)return IDBKeyRange.lowerBound(n,t);if(s!==void 0)return IDBKeyRange.upperBound(s,r)}function Me(e){var t;return"indexedDB"in window&&"deleteDatabase"in window.indexedDB?window.indexedDB.deleteDatabase((t=e.db)!=null?t:e.store):void 0}async function W(e){var r;let t=(r=e.db)!=null?r:e.store;return new Promise((n,s)=>{var i;(!("indexedDB"in window)||!("open"in window.indexedDB))&&s("no indexedDB");let o=window.indexedDB.open(t,(i=e==null?void 0:e.version)!=null?i:1);o.onsuccess=a=>n(a.target.result),o.onerror=a=>{var u;return s((u=a.target.error)!=null?u:"IndexedDB Unavailable")},o.onupgradeneeded=a=>{var h,w;let u=a.target.result,c=a.target.transaction,f=u.objectStoreNames.contains(e.store)?c.objectStore(e.store):u.createObjectStore(e.store),x=new Set(f.indexNames);(h=e.indices)==null||h.forEach(({name:g,keyPath:b,options:p})=>{if(!x.has(g))f.createIndex(g,b,p);else{let T=f.index(g);(T.keyPath!==b||T.unique!==!!(p!=null&&p.unique)||T.multiEntry!==!!(p!=null&&p.multiEntry))&&(f.deleteIndex(g),f.createIndex(g,b,p))}x.delete(g)}),x.forEach(g=>f.deleteIndex(g)),(w=e.upgrade)==null||w.call(e,a,f)}})}var j=/(^|[\s\n]|<[A-Za-z]*\/?>)((?:(?:https?|ftp):\/\/|lichess\.org)[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi,_=/\n/g,S=/(^|[^\w@#/])@([a-z0-9_-]{2,30})/gi,$e=e=>/(\n|(@|#|\.)\w{2,}|(board|game) \d)/i.test(e),I=(e,t,r=!0)=>`<a${r?"":' class="text"'} target="_blank" rel="nofollow noreferrer" href="${e}">${t}</a>`;function J(e){return e.match(/^[A-Za-z]+:\/\//)||(e="https://"+e),I(e,e.replace(/https?:\/\//,""))}var z=(e,t)=>e.replace(j,(r,n,s)=>n+t(s)),U=(e,t)=>({insert(r){r.elm.innerHTML=t(e),r.data.cachedA=e},postpatch(r,n){r.data.cachedA!==e&&(n.elm.innerHTML=t(e)),n.data.cachedA=e}});function E(e,t,r=!0){return e.includes("&quot;")?e:I(e.startsWith("/")||e.includes("://")?e:"//"+e,t||e,r)}var A=(e,t,r)=>t+E("/@/"+r,"@"+r),ze=e=>e.replace(S,A);function Z(e,t=!0){let r=z(P(e),J);return t&&(r=r.replace(_,"<br>")),r}function Ue(e,t=!0){return U(e,r=>Z(r,t))}var Q=/\b\b(?:https?:\/\/)?(lichess\.org\/[-–—\w+&'@#\/%?=()~|!:,.;]+[\w+&@#\/%=~|])/gi,F=/^[a-h][2-7]$/,G=/\b(\d+)\s*(\.+)\s*(?:[o0-]+[o0]|[NBRQKP\u2654\u2655\u2656\u2657\u2658\u2659]?[a-h]?[1-8]?[x@]?[a-h][1-8](?:=[NBRQK\u2654\u2655\u2656\u2657\u2658\u2659])?)\+?#?[!\?=]{0,5}/gi,X=/\b(?:board|game)\s(\d+)/gi;function Y(e,t,r){return t<1||t>200?e:'<a class="jump" data-ply="'+(t*2-(r.length>1?0:1))+'">'+e+"</a>"}function ee(e,t){return t<1||t>100?e:'<a data-board="'+t+'">'+e+"</a>"}var te=e=>e.replace(G,Y),re=e=>e.replace(X,ee),ne=(e,t,r)=>r.match(F)?e:A(e,t,r);function Ze(e,t){let r=P(e),n=r.replace(S,ne).replace(Q,E),s=t!=null&&t.plies&&n===r?te(n):n;return t!=null&&t.boards&&n===r?re(s):n}export{d as a,D as b,K as c,oe as d,se as e,R as f,m as g,ie as h,ae as i,ue as j,C as k,ce as l,de as m,le as n,P as o,ge as p,pe as q,fe as r,me as s,xe as t,l as u,Pe as v,y as w,L as x,O as y,ye as z,he as A,M as B,we as C,v as D,k as E,De as F,ve as G,Ve as H,N as I,Se as J,Ie as K,Ee as L,Ae as M,Ke as N,Re as O,Le as P,Oe as Q,Me as R,j as S,_ as T,S as U,$e as V,U as W,E as X,ze as Y,Z,Ue as _,Ze as $};
