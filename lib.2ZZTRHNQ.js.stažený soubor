import{a as b}from"./lib.XN2YPPXF.js";import{f,l as h}from"./lib.PA5MQ22V.js";import{c as x}from"./lib.XNXLGS2X.js";function g(e){let r=e.minLength||3,l=e.empty||(()=>'<div class="complete-list__empty">No results.</div>'),a=new Map,C=async t=>a.has(t)?new Promise(n=>setTimeout(()=>n(a.get(t)),50)):t.length>3&&Array.from({length:t.length-3},(n,o)=>-o-1).map(n=>t.slice(0,n)).some(n=>a.has(n)&&!a.get(n).length)?Promise.resolve([]):e.fetch(t).then(n=>(a.set(t,n),n)),c=()=>{if(i!==null)return u[i]},m=t=>{let n=u.length;i=(i===null?t===1?0:-1:i+t)%n,i<0&&(i+=n),p();let o=c();o&&(e.input.value=e.populate(o))},p=()=>{s.find(".complete-selected").removeClass("complete-selected"),i!==null&&s.find(".complete-result").eq(i).addClass("complete-selected")},s=$('<div class="complete-list none"></div>').insertAfter(e.input),i=null,u=[];e.input.autocomplete="off";let d=()=>{let t=e.input.value.trim();t.length>=r&&(!e.regex||t.match(e.regex))?C(t).then(v,console.log):s.addClass("none")};$(e.input).on({input:d,focus:d,blur(){return setTimeout(()=>s.addClass("none"),100),!0},keydown(t){if(!s.hasClass("none")){if(t.code==="ArrowDown")return m(1),!1;if(t.code==="ArrowUp")return m(-1),!1;if(t.code==="Enter"){s.addClass("none");let n=c()||(u[0]&&e.populate(u[0])==e.input.value?u[0]:void 0);if(n)return e.onSelect&&e.onSelect(n),!1}}}});let v=t=>{s.empty(),t[0]?t.forEach(n=>$(e.render(n)).on("mousedown touchdown",()=>{let o=e.populate(n);return e.input.value=o,e.onSelect&&e.onSelect(n),!0}).appendTo(s)):s.html(l()),u=t,i=null,p(),s.removeClass("none")}}var R=x(b(),1);function S(e){let r=(0,R.default)(l=>O(l,e),150);g({input:e.input,fetch:l=>r(l).then(U(l)),render:l=>w(l,e.tag),populate:e.populate||(l=>l.name),onSelect:e.onSelect,regex:/^[a-z][\w-]{2,29}$/i}),e.focus&&setTimeout(()=>e.input.focus())}var O=async(e,r)=>{let l=await f(h("/api/player/autocomplete",{term:e,friend:r.friend?1:0,tour:r.tour,swiss:r.swiss,team:r.team,object:1}));return{term:e,...l}},U=e=>r=>e===r.term?Promise.resolve(r.result):Promise.reject("Debounced "+e),w=(e,r="a")=>{let l=e.patronColor?` paco${e.patronColor}`:"";return"<"+r+' class="complete-result ulpt user-link'+(e.online?" online":"")+'" '+(r==="a"?"":"data-")+'href="/@/'+e.name+'"><i class="line'+(e.patron?" patron":"")+l+'"></i>'+(e.title?'<span class="utitle"'+(e.title==="BOT"?' data-bot="data-bot" ':"")+">"+e.title+"</span>&nbsp;":"")+e.name+(e.flair?'<img class="uflair" src="'+site.asset.flairSrc(e.flair)+'"/>':"")+"</"+r+">"};export{g as a,S as b,O as c,U as d,w as e};
